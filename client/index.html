<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <title>Adventure</title>
 <link rel="stylesheet" href="css/bootstrap.min.css">
 <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="content" class="full">Ooops, something wrong happened!</div>
  <script src="react/build/react.min.js"></script>
  <script src="react/build/JSXTransformer.js"></script>
  <script src="data/story.js"></script>
  <script type="text/jsx">
  var Story = React.createClass({
      render: function() {
        var now = this.props.story[this.props.state];
        var choices_letters = ['A','B','C']
        var choices = {}
        choices_letters.map((letter,i) => {
          if(now.choices.length > i){
            var choice = now.choices[i];
            choices[letter] = (<div className={letter}
              onClick={this.props.onStateChanged.bind(null,choice.next)}>
                {choice.message}
            </div>);
          }else{
            choices[letter] = <div className={letter}></div>
          }
        })
        choices.D = (<div className="D">MENU</div>)
        return (<section className="grid">
              <div>
                <div className="row">
                  {choices.A}
                  {choices.B}
                </div>
              </div>
              <div>
                <div className="row">
                  {choices.C}
                  {choices.D}
                </div>
              </div>
            </section>);
      }
    })

    var App = React.createClass({
      changeState: function(next){
        window.location.hash = next;
      },
      render: function() {
        return (<div className="full">
          <Story story={__STORY__} state={this.props.state} onStateChanged={this.changeState}/>
        </div>);
      }
    });


function render () {
  var route = window.location.hash.substr(1);
  console.log('route',route);
  if(route == ''){
    route = "start";
  }
  React.render(
    <App state={route} />,
    document.getElementById('content')
    );
}

window.addEventListener('hashchange', render);
render(); 
  </script>
</body>
</html>